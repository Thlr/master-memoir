\section{Reproducing the experiments}

TODO: organize this part (for now everything is simply copy pasted here) and complete it\\

The command used to run the scheduler is
\begin{minted}{bash}
	./scheduler --kubeconfig=<kubeconfig.yaml>
	--kube-api-content-type=application/json --leader-elect=false
	--scheduler-name=default
\end{minted}
\noindent Only the path to the \texttt{kubeconfig.yaml} changes to either point the the
emulated or simulated cluster.

Batkube is run with \mint{bash}| ./batkube --scheme=http --port=8001 |
\noindent followed by the simulator options.

Batsim is run with option \texttt{enable-compute-sharing}: for a reason
unknown, Kubernetes scheduler tends to over allocate resources in some cases
(especially with smaller jobs) which makes Batsim crash if this option is
disabled. We must allow compute sharing even when it is not expected in order
to capture the scheduler behavior as precisely as possible.\\

Those are the Batkube options that did not vary during the experiments:
\begin{itemize}
	\item \texttt{backoff-multiplier}: 2 (default value)
	\item \texttt{detect-scheduler-deadlock}: true. Obligatory for
		automating experiments
	\item \texttt{fast-forward-on-no-pending-jobs}: the scheduler is not
		susceptible to reschedule running jobs (there is a de-scheduler
		for that) so we might as well fast forward when there is
		nothing to schedule.

\end{itemize}

The option \texttt{scheduler-crash-timeout} did vary between experiments to
make up for odd scheduler crash detections (it was increased up to 30s).
However, it did not have any impact on the results as we do not take into
account simulation time in case of failure.

TODO

Limits: explain how dirty the resource management system is (non
thread safe, stored in memory, little hacks for the resource version) and
briefly write on how it induces problems for the scheduler (over allocating
resources) (we talk about this in the evaluation part).

\begin{figure}
	\begin{minted}{js}
{
  "now": 1024.24,
  "events": [
    {
      "timestamp": 1000,
      "type": "EXECUTE_JOB",
      "data": {
        "job_id": "workload!job_1234",
        "alloc": "1 2 4-8",
      }
    },
    {
      "timestamp": 1012,
      "type": "EXECUTE_JOB",
      "data": {
        "job_id": "workload!job_1235",
        "alloc": "12-100",
      }
    }
  ]
}
\end{minted}
\caption{Example of a Batsim message}
\label{fig:batmsg_ex}
\end{figure}


\begin{figure}
	\begin{minted}{js}
{
    "nb_res": 1,
    "jobs": [
	{"id":"1", "subtime":0, "res": 1, "profile": "delay10"},
	{"id":"2", "subtime":3.4, "res": 1, "profile": "delay10"}
    ],
    "profiles": {
	"delay10": {
	    "type": "delay",
	    "delay": 10,
	    "scheduler": "default",
	    "cpu": "1.5",
	    "memory": "500Mi"
	}
    }
}
	\end{minted}
	\caption{Example of a Batsim workload}
	\label{fig:bat_wl_ex}
\end{figure}
